# 无限开发工作流 (Infinite Development Workflow)

一个让 AI 在 Claude Code 中实现"无限开发"的工作流机制。基于双代理模式（初始化 + 编码），支持跨会话持续开发。

## 核心理念

**"无限开发"** 的关键在于：
1. **状态持久化** - 通过文件系统保存进度，而非依赖上下文记忆
2. **上下文无关** - 每个会话都是独立的，通过读取状态文件恢复工作
3. **任务驱动** - 以 feature_list.json 作为任务源，逐个完成
4. **自我延续** - 每个会话结束时留下清晰的状态，供下一会话继续

## 架构概览

```
┌─────────────────────────────────────────────────────────────┐
│                     会话 1 (初始化)                          │
│  ┌─────────────┐    ┌──────────────────┐    ┌───────────┐  │
│  │ app_spec.txt│───▶│  初始化代理       │───▶│项目结构搭建│  │
│  └─────────────┘    │ - 创建feature_list│    │ - init.sh │  │
│                     │ - 设计测试用例    │    │ - git init│  │
│                     └──────────────────┘    └───────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   会话 2-N (编码循环)                        │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  1. 读取状态 (feature_list.json, progress.txt)         ││
│  │  2. 选择下一个待完成任务                                ││
│  │  3. 实现功能 + 测试验证                                 ││
│  │  4. 更新 feature_list.json                             ││
│  │  5. 提交 Git + 更新 progress.txt                       ││
│  │  6. 循环回步骤 1                                        ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

## 快速开始

### 1. 准备项目规格

编辑 `prompts/app_spec.txt`，描述你要构建的应用：

```bash
# 示例：创建一个 Todo 应用
cat > prompts/app_spec.txt << 'EOF'
项目名称：智能待办事项应用
技术栈：React + Node.js + SQLite
核心功能：
- 任务 CRUD
- 分类管理
- 智能提醒
- 数据同步
EOF
```

### 2. 启动工作流

```bash
python core/workflow.py --project-dir ./my_project
```

### 3. 监控进度

```bash
# 查看进度
cat ./my_project/progress.json

# 查看 Git 历史
cd ./my_project && git log --oneline
```

## 核心文件说明

### feature_list.json（任务清单）

```json
[
  {
    "id": "feat-001",
    "category": "core",
    "description": "用户登录功能",
    "priority": 1,
    "steps": [
      "创建登录表单组件",
      "实现表单验证",
      "连接后端 API",
      "添加错误处理"
    ],
    "status": "pending",
    "verification": "手动测试登录流程"
  }
]
```

### progress.json（进度追踪）

```json
{
  "total_features": 50,
  "completed": 12,
  "in_progress": "feat-013",
  "last_session": "2024-01-15T10:30:00Z",
  "next_actions": [
    "完成 feat-013: 数据导出功能",
    "开始 feat-014: 用户设置页面"
  ]
}
```

### session_notes.md（会话笔记）

每个会话结束时记录：
- 本次完成了什么
- 遇到了什么问题
- 下次应该做什么
- 重要的技术决策

## 工作流程

### 初始化阶段

1. 读取 `app_spec.txt`
2. 生成详细的 `feature_list.json`
3. 创建项目目录结构
4. 编写 `init.sh` 启动脚本
5. 初始化 Git 仓库
6. 可选：开始第一个功能

### 编码阶段（循环）

1. **定位** - 读取所有状态文件，了解当前进度
2. **验证** - 运行现有测试，确保基础功能正常
3. **选择** - 从 feature_list 中选择下一个待完成任务
4. **实现** - 编写代码、添加测试
5. **验证** - 确保功能正常工作
6. **记录** - 更新 feature_list.json 和 progress.json
7. **提交** - Git commit 记录变更
8. **循环** - 返回步骤 1 继续

## 安全机制

工作流内置多层安全防护：

1. **沙箱隔离** - Bash 命令在受限环境中执行
2. **命令白名单** - 只允许预定义的安全命令
3. **文件系统限制** - 只能访问项目目录
4. **Git 追踪** - 所有变更都有版本记录

## 自定义配置

### 调整并发

```python
# core/config.py
MAX_ITERATIONS = None  # 无限循环
SESSION_DELAY = 3      # 会话间隔秒数
```

### 修改安全策略

```python
# core/security.py
ALLOWED_COMMANDS = {
    "npm", "node", "git", "python",
    # 添加你需要的命令
}
```

### 自定义提示词

编辑 `prompts/` 目录下的文件：
- `initializer_prompt.md` - 初始化代理指令
- `coding_prompt.md` - 编码代理指令

## 最佳实践

1. **明确规格** - app_spec.txt 越详细，生成质量越高
2. **增量提交** - 每完成一个小功能就提交
3. **保持验证** - 每个会话开始时先验证现有功能
4. **记录决策** - 在 session_notes.md 中记录重要决策
5. **定期回顾** - 检查 progress.json 确保方向正确

## 故障排除

### Q: 会话中断后如何继续？
A: 直接运行相同的命令，工作流会自动从上次进度继续。

### Q: 如何修改已生成的 feature_list？
A: 可以手动编辑 feature_list.json，但建议只修改 status 字段。

### Q: 遇到问题如何回滚？
A: 使用 Git 回滚到上一个稳定版本：`git reset --hard HEAD~1`

## 许可证

MIT License
